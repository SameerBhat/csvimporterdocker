<!DOCTYPE html>
<html>

<head>
    <meta charset="ISO-8859-1">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css"
        integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
    <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js"
        integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN"
        crossorigin="anonymous"></script>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js"
        integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q"
        crossorigin="anonymous"></script>


    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js"
        integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl"
        crossorigin="anonymous"></script>


    <title>ANN</title>
</head>
<style>
    table {
        font-family: arial, sans-serif;
        border-collapse: collapse;
        width: 50%;
        length: 50%;
    }

    div#csv {
        margin-bottom: 52px !important;
    }

    th {
        border: 1px solid #dddddd;
        text-align: center;
        padding: 8px;
        background-color: "#5868c5";
    }

    td {
        border: 1px solid #dddddd;
        text-align: left;
        padding: 8px;
        color: #464C4C;
    }

    tr {
        color: #464C4C;
    }

    p {
        display: block;
        margin-top: 1em;
        margin-bottom: 1em;
        margin-left: 0;
        margin-right: 0;
    }

    textarea {
        width: 600px;
        padding: 3px;
        border: none;
    }

    h1 {

        font-family: Arial, Helvetica, sans-serif;
        font-weight: 700;


    }

    button {
        border-radius: 10px;
        font: bold;
        background-color: #d3d3d3;
        color: #cf0000;
    }

    div {
        font-family: 'Trebuchet MS', 'Lucida Sans Unicode', 'Lucida Grande', 'Lucida Sans', Arial, sans-serif;
    }



    .speaker1,
    .table-hover>tbody>tr.speaker1:hover,
    table>tbody>tr.speaker1>td {
        background: #28a745;
        color: #fff !important;
    }

    tr.speaker1>td>div>select {
        color: #000 !important;
    }



    #tableHead td {
        position: sticky;
        top: 82px;
        background: steelblue;
        color: white;
    }

    .nav>li>a {
        position: relative;
        display: block;
        padding: 4px 6px;
    }


    /* STYLES FOR MULTI LEVEL DROPDOWN */
    .dropdown .dropdown-menu .caret {
        border: 4px solid transparent;
        border-left-color: #000;
        float: right;
        margin-top: 6px;
    }

    .dropdown-menu {
        min-width: 250px;
    }

    .dropdown-menu>li.open>a {
        background-color: #F5F5F5;
        color: #262626;
        text-decoration: none;
    }

    .dropdown-menu .dropdown-menu {
        left: 100%;
        margin: 0;
        right: auto;
        top: -1px;
    }

    .dropdown-menu-right .dropdown-menu,
    .navbar-right .dropdown-menu .dropdown-menu,
    .pull-right .dropdown-menu .dropdown-menu {
        left: auto;
        right: 100%;
    }

    .dropdown-menu.animated {
        -webkit-animation-duration: 0.3s;
        animation-duration: 0.3s;
    }

    .dropdown-menu.animated:before {
        content: " ";
        display: block;
        height: 100%;
        left: 0;
        position: absolute;
        top: 0;
        width: 100%;
        z-index: 99;
    }

    .dropdownhover-top {
        margin-bottom: 2px;
        margin-top: 0;
    }

    .navbar-fixed-bottom .dropdown-menu .dropdown-menu,
    .dropdownhover-top .dropdown-menu {
        bottom: -1px;
        top: auto;
    }

    .navbar-nav>li>.dropdown-menu {
        margin-bottom: 0;
    }

    .dropdownhover-bottom {
        -webkit-transform-origin: 50% 0;
        transform-origin: 50% 0;
    }

    .dropdownhover-left {
        -webkit-transform-origin: 100% 50%;
        transform-origin: 100% 50%;
    }

    .dropdownhover-right {
        -webkit-transform-origin: 0 50%;
        transform-origin: 0 50%;
    }

    .dropdownhover-top {
        -webkit-transform-origin: 50% 100%;
        transform-origin: 50% 100%;
    }

    .dropdown,
    .dropup {

        /* z-index: 1; */
    }

    .navbar-brand {
        background-image: url('data:image/svg+xml;charset=utf-8;base64,PHN2ZyB2ZXJzaW9uPSIxLjEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgeG1sbnM6eGxpbms9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkveGxpbmsiIHg9IjBweCIgeT0iMHB4IiB2aWV3Qm94PSIwIDAgNjU4LjIgMTQ2IiBzdHlsZT0iZW5hYmxlLWJhY2tncm91bmQ6bmV3IDAgMCA2NTguMiAxNDY7IiB4bWw6c3BhY2U9InByZXNlcnZlIj48Zz48cG9seWdvbiBmaWxsPSIjRDUyQjFFIiBwb2ludHM9IjY0My43LDAgNjA3LjgsNzYuOCA1OTQuMyw0Ny43IDU3OS43LDQ3LjcgNjAxLjksOTUuMyA2MTMuNyw5NS4zIDY1OC4yLDAgCSIvPjxwYXRoIGQ9Ik00ODkuNywxNDIuNmgyOC45Vjg5LjdjMC0xMi4xLDctMjAuNiwxNy40LTIwLjZjMTAsMCwxNS4yLDcsMTUuMiwxNy4xdjU2LjRoMjguOVY4MC43YzAtMjEtMTIuNi0zNS44LTMzLTM1LjggYy0xMywwLTIyLjEsNS42LTI4LjksMTUuOGgtMC42di0xM2gtMjhMNDg5LjcsMTQyLjZMNDg5LjcsMTQyLjZ6IE00MzIuOSw0NS4xYy0zMC4yLDAtNTAuNCwyMS43LTUwLjQsNTAuMyBjMCwyOC40LDIwLjIsNTAuMyw1MC40LDUwLjNzNTAuNC0yMS45LDUwLjQtNTAuM0M0ODMuNCw2Ni44LDQ2My4xLDQ1LjEsNDMyLjksNDUuMXogTTQzMi43LDEyNC4zYy0xMy43LDAtMjEtMTEuNS0yMS0yOC45CWMwLTE3LjYsNy4yLTI4LjksMjEtMjguOWMxMy43LDAsMjEuMywxMS4zLDIxLjMsMjguOUM0NTQuMSwxMTIuOCw0NDYuNSwxMjQuMyw0MzIuNywxMjQuM3ogTTMwMC4xLDE0Mi42aDgxLjJ2LTIyLjhoLTQ2di0wLjYJbDQ0LTQ5LjNWNDcuNmgtNzkuMnYyMi45aDQ0LjV2MC42bC00NC41LDQ5LjdMMzAwLjEsMTQyLjZMMzAwLjEsMTQyLjZ6IE0yNjMsMTQyLjZoMjkuMVY0Ny43SDI2M1YxNDIuNnogTTE5NS41LDE0Mi42aDI5Vjk5CWMwLTE5LjgsMTEuOS0yOC42LDMwLTI2LjFoMC42di0yNWMtMS41LTAuNi0zLjItMC43LTUuOS0wLjdjLTExLjMsMC0xOC45LDUuMi0yNS40LDE2LjNoLTAuNlY0Ny43aC0yNy43VjE0Mi42eiBNMTQyLjMsMTI0LjQJYy0xMi44LDAtMjAuNi04LjMtMjIuMS0yMS4xaDY4LjRjMC4yLTIwLjQtNS4yLTM2LjctMTYuNS00Ni45Yy04LTcuNC0xOC41LTExLjUtMzEuOS0xMS41Yy0yOC42LDAtNDguNCwyMS43LTQ4LjQsNTAuMQljMCwyOC42LDE4LjksNTAuNCw1MC4zLDUwLjRjMTEuOSwwLDIxLjMtMy4yLDI5LjEtOC41YzguMy01LjcsMTQuMy0xNC4xLDE1LjktMjIuNGgtMjcuOEMxNTYuNiwxMjAuNywxNTAuOCwxMjQuNCwxNDIuMywxMjQuNHogTTE0MC44LDY1LjZjMTAuMiwwLDE3LjIsNy42LDE4LjQsMTguN2gtMzguOEMxMjIuNyw3My4xLDEyOC44LDY1LjYsMTQwLjgsNjUuNnogTTM0LDE0Mi42aDMwLjRsMzMtOTQuOUg2OC4zbC0xOC41LDYxaC0wLjQJbC0xOC41LTYxSDFMMzQsMTQyLjZ6IE0yNjMsMTMuOWgyOS4xdjI1LjhIMjYzVjEzLjl6Ii8+PC9nPjwvc3ZnPg==');
        height: 50px;
        width: 200px;
        display: block;
        background-repeat: no-repeat;

    }

    .navbar-light {
        background-color: #ffffff !important;
    }


    .navbar {
        border-bottom: 1px solid #d8dada;

    }

    .title-name {
        background: url(https://ss7.vzw.com/is/image/VerizonWireless/exp-super-mini-banner-holiday-d?&scl=1) no-repeat center;
        background-size: cover;
        max-width: 100%;
        width: 100%;
        justify-content: center;
        display: flex;
        height: 84px;
        border-bottom: 1px solid #d8dada;
    }

    #bottomNavContent {
        flex-direction: row;
    }

    #bottomNavContent>li {
        display: inline !important;
    }

    #bottomNav {
        padding: 0px;
    }
</style>

<body>

    <nav class="navbar fixed-top navbar-light bg-light py-3 pl-4">
        <a class="navbar-brand" href="#">
        </a>
    </nav>


    <div style="margin-top: 83px; margin-bottom: 30px;">
        <div class="title-name text-center">
            <h1 style="padding: 18px;">Agent's Notes Labeling Tool</h1>
        </div>

        <div class="text-center mt-3"> <span> <a href="/nap/readme.html" target="_blank">Click here</a> to find notes on
                promises </span></div>
        <div class="text-center"> <span> <a href="/nap/secondfile.html" target="_blank">Click here</a> to find second
                note </span></div>
    </div>


    <div class="form-row m-2">
        <div class="col">
            <div class="custom-file">
                <input type="file" class="custom-file-input" id="fileUpload">
                <label class="custom-file-label" for="customFile">Choose CSV file</label>
            </div>
        </div>
        <div class="col">
            <button type="button" class="btn btn-primary" id="Submit" onclick="getCSV();">Upload CSV</button>
        </div>
    </div>


    <div id="selectAgentContainer">
        <div class="form-row m-2">
            <div class="col">
                <div class="form-group">
                    <label for="agentDropdown">Who is Agent?</label>
                    <select id="agentDropdown" class="custom-select">
                        <option value="ch1">Ch1</option>
                        <option value="ch2">Ch2</option>
                        <option value="ch3">Ch3</option>
                        <option value="ch4">Ch4</option>
                        <option value="ch5">Ch5</option>
                        <option value="ch6">Ch6</option>
                    </select>

                </div>
            </div>

           
            <div class="col">
                <div class="form-group">
                    <label for="customerDropdown">Who is Customer?</label>
                    <select id="customerDropdown" class="custom-select">

                        <option value="ch1">Ch1</option>
                        <option value="ch2">Ch2</option>
                        <option value="ch3">Ch3</option>
                        <option value="ch4">Ch4</option>
                        <option value="ch5">Ch5</option>
                        <option value="ch6">Ch6</option>

                    </select>
                </div>
            </div>


        </div>




       



        <div class="form-row m-2">

            <div class="col">
                <div class="form-group">
                    <label for="cpn_name">Cpn Name</label>
                    <input class="form-control" id="cpn_name" type="text" placeholder="Cpn Name">
                </div>
            </div>

           






        </div>


    </div>





    <div>


        <button type="button" class="btn btn-success btn-block m-3" id="Save"
            onclick="exportTableToCSV();"><b>SAVE</b></button></div>
    <br />


    </div>

    <div class="csv" id="csv">

    </div>



    <nav class="navbar fixed-bottom navbar-inverse bg-dark" id="bottomNav" style="display: none;">
        <div>
            <ul id="bottomNavContent">

            </ul>
        </div>
    </nav>

    <script>

        var initialTableDataArray = [];
        var selectedAgent = '';
        var cpn_name;

      


        $('#selectAgentContainer').hide();

        function exportTableToCSV() {
            var mSelectedAgent = $("#agentDropdown").children("option:selected").val();
            var mSelectedCustomer = $("#customerDropdown").children("option:selected").val();

            var finalTableDataArray = [];
            var filename = "label_" + document.getElementById("fileUpload").files[0].name;
            var csv = [];
            var rows = document.querySelectorAll("table tr");


            for (var i = 0; i < rows.length; i++) {
                var row = [];
                var cols = rows[i].querySelectorAll("td, th");

                for (var j = 0; j < cols.length; j++) {

                    if (i > 0) {
                        if (j == 12 || j == 15) {

                            // var d = "topic" + i + "c" + j;

                            // var e = document.getElementById(d);

                            // var strVlaue = '';
                            // if (e.innerText.trim() == 'Dropdown') {
                            //     strVlaue = '';
                            // } else {
                            //     strVlaue = e.innerText;
                            // }

                            // row.push(strVlaue.trim());


                            var dp = "topic" + i + "c" + j;

                            var ep = document.getElementById(dp);
                            var strVlaue = ep.options[ep.selectedIndex].text;
                            row.push(strVlaue.trim());

                        }
                        else if (j == 5 || j == 8) {
                            var dp = "promise" + i + "c" + j;

                            var ep = document.getElementById(dp);
                            var strVlaue = ep.options[ep.selectedIndex].text;
                            row.push(strVlaue.trim());
                        }
                        else {
                            row.push(cols[j].textContent.trim());
                        }
                    }
                    else { row.push(cols[j].textContent.trim()); }


                }

                var row2 = [...row]

                var start = row2.length - 3;

                row2.splice(start, 3);
               

                finalTableDataArray.push(row2.join(""));

                if(i != 0){
    if (initialTableDataArray[i] != finalTableDataArray[i]) {
                    console.log("row edited is: " + i);
                    rows[i].lastChild.firstChild.textContent = mSelectedCustomer;
                    row[cols.length - 1] = mSelectedCustomer;


rows[i].lastChild.previousSibling.firstChild.textContent = mSelectedAgent;
                    row[cols.length - 2] = mSelectedAgent;

                }
}
   

                var finalRow = row.join(",");
                csv.push(finalRow);
            }


            console.log('Initial array: ' + initialTableDataArray[1]);
            console.log('Final  array: ' + finalTableDataArray[1]);


            initialTableDataArray = finalTableDataArray;
            download_csv(csv.join("\n"), filename);

        }
        function download_csv(csv, filename) {
            var csvFile;
            var downloadLink;
            csvFile = new Blob([csv], { type: "text/csv" });
            downloadLink = document.createElement("a");
            downloadLink.download = filename;
            downloadLink.href = window.URL.createObjectURL(csvFile);
            downloadLink.style.display = "none";
            document.body.appendChild(downloadLink);
            downloadLink.click();





        }

        function getCSV() {

            var columnNamesArray = [];

            $('#cpn_name').val('')
           

            // document.getElementById("Submit").setAttribute("hidden", "true");
            var fileUpload = document.getElementById("fileUpload");

            var regex = /^([a-zA-Z0-9\s_\\.\-:])+(.csv|.txt)$/;

            if (typeof (FileReader) != "undefined") {
                var reader = new FileReader();
                reader.onload = function (e) {
                    var table = document.createElement("table");
                    $('#selectAgentContainer').show();

                    table.setAttribute("id", "newTable");
                    table.setAttribute("class", "table table-hover");

                    var rows = e.target.result.split("\n");

                    console.log('original cols ' + rows.length);




                    if (rows[rows.length - 1].length == 0) {
                        rows.splice(rows.length - 1, 1)
                    }

                    var firstRowText = 'fnum,time,speaker,paragraph,annotators_name,promise1,pwrd1,promise_phrase1,promise2,pwrd2,promise_phrase2,promise_comment,TOPIC1,twrd1,pharse1,TOPIC2,twrd2,pharse2,sentiment_phrase1,sentiment_phrase2,cpn_name,agent,customer';
                    rows[0] = firstRowText;


                    var textBox = document.createElement('input');
                    textBox.type = "text";



                    for (var i = 0; i < rows.length; i++) {
                        var cells = rows[i].split(",");

                        if (i != 0 && cells.length <= 22) {

                            rows[i] = rows[i] + ',,,,,,,,,,,';
                            cells = rows[i].split(",");

                            console.log('new cols ' + cells.length)
                        }


                        if (cells.length > 1) {

                            var row = table.insertRow(-1);



                            if (i == 0) {
                                row.setAttribute("id", "tableHead");

                            }


                            var rowValue = [];

                            for (var j = 0; j < cells.length; j++) {



                                var cell = row.insertCell(-1);
                                var id = "topic" + i + "c" + j;
                                var promiseid = "promise" + i + "c" + j;

                                cell.innerHTML = cells[j];



                                if (i == 0) {


                                    cell.innerHTML = "<b>" + cells[j] + "</b>";
                                    var column = {}
                                    column.name = cells[j];
                                    column.id = j;
                                    columnNamesArray.push(column);


                                }

                                cell.setAttribute("class", "col" + j);


                                if (i > 0 && cells[j] == "") {

                                    if (j == 12 || j == 15) {

                                        cell.innerHTML = "<div contenteditable><select id=" + id + "><option></option><option>Call_back</option><option>Drop_ship</option><option>Dispatch</option><option>Send_to_offline</option><option>No_charge</option><option>Transfer</option><option>First_appointment</option><option>Sooner_appointment</option><option>Will_be_there_today</option><option>Refer_to_other_group</option><option>Outage_will_be_resolved_by_time</option><option>OTHER</option><option>NO_PROMISE</option><option>BROKEN_PROMISE</option></select></div>";
                                    }
                                    else if (j == 5 || j == 8) {
                                        cell.innerHTML = "<div contenteditable><select id=" + promiseid + "><option></option><option>Call_back</option><option>Drop_ship</option><option>Dispatch</option><option>Send_to_offline</option><option>No_charge</option><option>Transfer</option><option>First_appointment</option><option>Sooner_appointment</option><option>Will_be_there_today</option><option>Refer_to_other_group</option><option>Outage_will_be_resolved_by_time</option><option>OTHER</option><option>NO_PROMISE</option><option>BROKEN_PROMISE</option></select></div>"
                                    } else if (j == 3) {
                                        cell.innerHTML = "<div contenteditable style='width:400px;'></div>";
                                    }

                                    else {

                                        cell.innerHTML = "<div contenteditable></div>";
                                    }


                                }
                                else if (i > 0 && cells[j] != "") {

                                    
                                    if (j == 12 || j == 15) {
                                        console.log(cells[j])
                                        cell.innerHTML = "<div contenteditable><select id=" + id + "><option selected>" + cells[j] + "</option><option>Call_back</option><option>Drop_ship</option><option>Dispatch</option><option>Send_to_offline</option><option>No_charge</option><option>Transfer</option><option>First_appointment</option><option>Sooner_appointment</option><option>Will_be_there_today</option><option>Refer_to_other_group</option><option>Outage_will_be_resolved_by_time</option><option>OTHER</option><option>NO_PROMISE</option><option>BROKEN_PROMISE</option></select></div>"
                                    }
                                    else if (j == 5 || j == 8) {
                                        cell.innerHTML = "<div contenteditable><select id=" + promiseid + "><option>" + cells[j] + "</option><option>Call_back</option><option>Drop_ship</option><option>Dispatch</option><option>Send_to_offline</option><option>No_charge</option><option>Transfer</option><option>First_appointment</option><option>Sooner_appointment</option><option>Will_be_there_today</option><option>Refer_to_other_group</option><option>Outage_will_be_resolved_by_time</option><option>OTHER</option><option>NO_PROMISE</option><option>BROKEN_PROMISE</option></select></div>"
                                    } else if (j == 3) {
                                        cell.innerHTML = "<div contenteditable style='width:400px;'>" + cells[j] + "</div>";

                                    } else if (j == 3) {

                                        cell.innerHTML = "<div contenteditable>" + cells[j] + "</div>";
                                        // row.setAttribute("class",cells[j].toLowerCase());
                                    }
                                 else if (j == 20) {
                                        $('#cpn_name').val(cells[j]);


                                    }
                                    else {


                                        cell.innerHTML = "<div contenteditable>" + cells[j] + "</div>";
                                    }

                                }
                                rowValue.push(cells[j].trim());
                            }

                            var rowValue2 = [...rowValue];
                            rowValue2.pop();
                            initialTableDataArray.push(rowValue2.join(""));
                        }


                    }
                    var dvCSV = document.getElementById("csv");
                    dvCSV.innerHTML = "";
                    dvCSV.appendChild(table);


                    var finalColumnsarr = columnNamesArray.filter(function (el) {
                        return el.name != '';
                    });

                    $('#bottomNav').css("display", "block");

                    $('#bottomNavContent').html('');
                    finalColumnsarr.forEach(element => {
                        if (element.name === 'cpn_name') {

                             $('.col'+element.id).hide();
                            
                            cpn_name = element;

                        
                        } else {

                            $('#bottomNavContent').append(`<li style="color:white; margin-right:8px; margin-top:5px; padding:5px;"><input type="checkbox"  class="toggle-columns" value="${element.id}" checked> ${element.name}</li>`);

                        }

                    });


                    $('.toggle-columns').change(function () {
                        var value = this.value;
                        if (this.checked) {
                            $('.col' + value).show();
                        } else {
                            $('.col' + value).hide();
                        }
                    });
                }
                reader.readAsText(fileUpload.files[0]);
            } else {
                alert("This browser does not support HTML5.");
            }



        }


        $('body').on('click', '.dropdown_clickable', function (event) {

            event.preventDefault();
            var value = $(this).attr('data-value');
            if (value != 'Other') {
                var dropdownElement = $(this).closest('ul').closest('li').closest('ul').prev('a')
                dropdownElement.html(value);
                $('.dropdown').removeClass('open');

            } else {
                var dropdownElement = $(this).closest('ul').prev('a')
                dropdownElement.html(value);
                dropdownElement.parent('div').find('.dropdown').removeClass('open');
            }



        });


        $('body').on('click', '.dropdown', function (event) {

            // event.preventDefault();
            // event.stopPropagation();

            console.log('custom dropdown')


            // var targetElement = $(this);

            // targetElement.parent('ul').find('.dropdown').removeClass("open");

            // if (!targetElement.hasClass('open')) {
            //     targetElement.addClass('open');
            // } else {
            //     targetElement.removeClass('open');
            // }

            $("ul.dropdown-menu [data-toggle='dropdown']").on("click", function (event) {
                event.preventDefault();
                event.stopPropagation();

                $(this).siblings().toggleClass("show");


                if (!$(this).next().hasClass('show')) {
                    $(this).parents('.dropdown-menu').first().find('.show').removeClass("show");
                }
                $(this).parents('li.nav-item.dropdown.show').on('hidden.bs.dropdown', function (e) {
                    $('.dropdown-submenu .show').removeClass("show");
                });

            });

        });


        $('#cpn_name').on('input', function () {
            var value = $(this).val();
            $('.col' + cpn_name.id).eq(1).html(value);
        });



       

    </script>

</body>

</html>